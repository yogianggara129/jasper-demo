<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd"
    name="invoice_report" pageWidth="595" pageHeight="842"
    columnWidth="555" leftMargin="20" rightMargin="20"
    topMargin="20" bottomMargin="20" uuid="acb049b2-039e-4579-a4e6-b0c6304a7a73">

    <!-- ðŸ§© SubDataset untuk nested list Item -->
    <subDataset name="ItemsDataset">
        <field name="product" class="java.lang.String" />
        <field name="qty" class="java.lang.Integer" />
        <field name="price" class="java.lang.Double" />
    </subDataset>

    <!-- ðŸ§¾ Field utama Invoice -->
    <field name="invoiceNumber" class="java.lang.String" />
    <field name="customerName" class="java.lang.String" />
    <field name="items" class="java.util.List" />

    <!-- ðŸ·ï¸ Header laporan -->
    <title>
        <band height="40">
            <staticText>
                <reportElement x="0" y="0" width="200" height="30" />
                <text><![CDATA[INVOICE REPORT]]></text>
            </staticText>
        </band>
    </title>

    <!-- ðŸ“„ Detail setiap invoice -->
    <detail>
        <band height="100">

            <textField>
                <reportElement x="0" y="0" width="200" height="20" />
                <textFieldExpression><![CDATA["Invoice: " + $F{invoiceNumber}]]></textFieldExpression>
            </textField>

            <textField>
                <reportElement x="0" y="20" width="200" height="20" />
                <textFieldExpression><![CDATA["Customer: " + $F{customerName}]]></textFieldExpression>
            </textField>

            <!-- ðŸ§¾ List item di dalam invoice -->
            <componentElement>
                <reportElement x="0" y="45" width="500" height="50" />
                <jr:list xmlns:jr="http://jasperreports.sourceforge.net/jasperreports/components"
                    xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd">
                    <datasetRun subDataset="ItemsDataset">
                        <dataSourceExpression><![CDATA[new net.sf.jasperreports.engine.data.JRBeanCollectionDataSource($F{items})]]></dataSourceExpression>
                    </datasetRun>

                    <jr:listContents height="20">
                        <textField>
                            <reportElement x="0" y="0" width="150" height="20" />
                            <textFieldExpression><![CDATA[$F{product}]]></textFieldExpression>
                        </textField>
                        <textField>
                            <reportElement x="160" y="0" width="100" height="20" />
                            <textFieldExpression><![CDATA[$F{qty}]]></textFieldExpression>
                        </textField>
                        <textField>
                            <reportElement x="270" y="0" width="100" height="20" />
                            <textFieldExpression><![CDATA[$F{price}]]></textFieldExpression>
                        </textField>
                    </jr:listContents>
                </jr:list>
            </componentElement>

        </band>
    </detail>
</jasperReport>